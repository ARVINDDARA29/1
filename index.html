<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="monetag" content="58e2954bf0a854d2f0d747ecce1e8bbc">
    <meta name="b448b54f4ed44237d86986f5a565b98127a55ba8" content="b448b54f4ed44237d86986f5a565b98127a55ba8" />
    <meta name="verify-admitad" content="c6ee17c1b2" />
    <title>BISHNOI 29 - रिवॉर्ड ऐप</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* कस्टम CSS नियम */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #151A25; /* गहरा नीला-बैंगनी */
            color: #E0E7FF; /* हल्का नीला-सफेद */
            overflow-x: hidden;
            touch-action: pan-y;
        }

        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
            position: relative;
        }

        .screen.active {
            display: flex;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .modal-content {
            background-color: #1E293B;
            border-radius: 1rem;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        .card {
            background-color: #1E293B;
            border-radius: 1rem;
            padding: 1.5rem;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .gradient-text {
            background: linear-gradient(90deg, #6366F1, #8B5CF6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .lucide-icon {
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }
        
        /* ऑफर कार्ड्स के लिए विशिष्ट शैली */
        .offer-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .offer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        
        /* वीडियो प्लेयर के लिए शैली */
        #video-player-modal .modal-content {
            width: 100%;
            height: 100%;
            max-width: none;
            max-height: none;
            background-color: #151A25;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0;
        }

        #video-player-modal video {
            width: 100%;
            height: 100%;
            max-width: 800px;
            object-fit: contain;
        }

        #video-player-modal .close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 50%;
            padding: 0.5rem;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-[#151A25] text-[#E0E7FF] font-sans">
    
    <!-- मुख्य स्क्रीन -->
    <div id="main-screen" class="screen active">
        <div class="card p-8 text-center bg-[#1E293B] rounded-2xl shadow-lg">
            <h1 class="text-4xl font-bold font-poppins text-white mb-2">BISHNOI 29</h1>
            <h2 class="text-xl font-semibold mb-6 gradient-text">रिवॉर्ड ऐप</h2>
            <p class="text-lg mb-8">अपने गेम और एप्लिकेशन के लिए रिवॉर्ड प्राप्त करें!</p>
            <button id="start-button" class="w-full py-3 px-6 bg-[#6366F1] text-white rounded-xl font-semibold text-lg hover:bg-[#4F46E5] transition-colors duration-300 transform hover:scale-105">
                प्रारंभ करें
            </button>
        </div>
    </div>
    
    <!-- होम स्क्रीन -->
    <div id="home-screen" class="screen">
        <div class="card p-6 bg-[#1E293B] rounded-2xl shadow-lg w-full max-w-lg relative">
            <div class="absolute top-4 left-4 p-2 bg-[#1A202C] rounded-full text-[#6366F1] flex items-center justify-center">
                <span id="user-points" class="font-bold text-lg mr-1">0</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-gem"><path d="M6 3h12l3 9-9 9-9-9z"/><path d="M12 21V3"/></svg>
            </div>
            <div class="flex justify-center mb-6">
                <img src="https://placehold.co/100x100/151A25/FFFFFF?text=Logo" alt="App Logo" class="rounded-full">
            </div>
            <h1 class="text-3xl font-bold text-center mb-4">रिवॉर्ड्स</h1>
            
            <div class="grid grid-cols-2 gap-4">
                <!-- Google Play कार्ड -->
                <div class="offer-card flex flex-col items-center p-4 bg-[#2D3748] rounded-xl text-center">
                    <img src="https://placehold.co/80x80/2D3748/FFFFFF?text=Google+Play" alt="Google Play Icon" class="w-20 h-20 mb-2">
                    <h3 class="font-semibold text-lg">Google Play</h3>
                    <p class="text-sm text-gray-400">रिवॉर्ड प्राप्त करें</p>
                </div>
                
                <!-- Free Fire कार्ड -->
                <div class="offer-card flex flex-col items-center p-4 bg-[#2D3748] rounded-xl text-center">
                    <img src="https://placehold.co/80x80/2D3748/FFFFFF?text=Free+Fire" alt="Free Fire Icon" class="w-20 h-20 mb-2">
                    <h3 class="font-semibold text-lg">Free Fire</h3>
                    <p class="text-sm text-gray-400">रिवॉर्ड प्राप्त करें</p>
                </div>
            </div>

            <button id="claim-button" class="w-full py-3 mt-6 bg-[#8B5CF6] text-white rounded-xl font-semibold text-lg hover:bg-[#7C3AED] transition-colors duration-300">
                रिवॉर्ड का दावा करें
            </button>
        </div>
    </div>
    
    <!-- रिवॉर्ड स्क्रीन -->
    <div id="rewards-screen" class="screen">
        <div class="card p-6 bg-[#1E293B] rounded-2xl shadow-lg w-full max-w-xl">
            <div class="flex items-center justify-between mb-4">
                <button id="back-to-home-button" class="flex items-center text-[#9CA3AF] hover:text-[#E0E7FF] transition-colors duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left-circle"><circle cx="12" cy="12" r="10"/><path d="m12 8-4 4 4 4"/><path d="M16 12H8"/></svg>
                    <span class="ml-2">वापस</span>
                </button>
                <h1 id="rewards-title" class="text-2xl font-bold font-poppins text-center flex-grow">रिवॉर्ड्स</h1>
            </div>
            
            <!-- Google Play ऑफर -->
            <div id="google-play-offers" class="offer-grid grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8" style="display: none;">
                <!-- ऑफर 1 -->
                <div class="offer-card flex flex-col items-center p-4 bg-[#2D3748] rounded-xl text-center">
                    <img src="https://placehold.co/80x80/2D3748/FFFFFF?text=Google+Play" alt="Google Play Icon" class="w-20 h-20 mb-2">
                    <h3 class="font-semibold text-lg">₹100</h3>
                    <p class="text-sm text-gray-400">आवश्यक: 2000 अंक</p>
                    <button class="claim-offer-button mt-2 py-1 px-4 bg-[#6366F1] text-white rounded-md text-sm hover:bg-[#4F46E5]">दावा करें</button>
                </div>
                <!-- ऑफर 2 -->
                <div class="offer-card flex flex-col items-center p-4 bg-[#2D3748] rounded-xl text-center">
                    <img src="https://placehold.co/80x80/2D3748/FFFFFF?text=Google+Play" alt="Google Play Icon" class="w-20 h-20 mb-2">
                    <h3 class="font-semibold text-lg">₹500</h3>
                    <p class="text-sm text-gray-400">आवश्यक: 10000 अंक</p>
                    <button class="claim-offer-button mt-2 py-1 px-4 bg-[#6366F1] text-white rounded-md text-sm hover:bg-[#4F46E5]">दावा करें</button>
                </div>
            </div>
            
            <!-- Free Fire ऑफर -->
            <div id="free-fire-offers" class="offer-grid grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8" style="display: none;">
                <!-- ऑफर 1 -->
                <div class="offer-card flex flex-col items-center p-4 bg-[#2D3748] rounded-xl text-center">
                    <img src="https://placehold.co/80x80/2D3748/FFFFFF?text=Free+Fire" alt="Free Fire Icon" class="w-20 h-20 mb-2">
                    <h3 class="font-semibold text-lg">100 हीरे</h3>
                    <p class="text-sm text-gray-400">आवश्यक: 1500 अंक</p>
                    <button class="claim-offer-button mt-2 py-1 px-4 bg-[#6366F1] text-white rounded-md text-sm hover:bg-[#4F46E5]">दावा करें</button>
                </div>
                <!-- ऑफर 2 -->
                <div class="offer-card flex flex-col items-center p-4 bg-[#2D3748] rounded-xl text-center">
                    <img src="https://placehold.co/80x80/2D3748/FFFFFF?text=Free+Fire" alt="Free Fire Icon" class="w-20 h-20 mb-2">
                    <h3 class="font-semibold text-lg">500 हीरे</h3>
                    <p class="text-sm text-gray-400">आवश्यक: 7500 अंक</p>
                    <button class="claim-offer-button mt-2 py-1 px-4 bg-[#6366F1] text-white rounded-md text-sm hover:bg-[#4F46E5]">दावा करें</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ऑफर स्क्रीन -->
    <div id="offer-screen" class="screen">
        <div class="card p-6 bg-[#1E293B] rounded-2xl shadow-lg w-full max-w-xl">
            <div class="flex items-center justify-between mb-4">
                <button id="back-to-rewards-button" class="flex items-center text-[#9CA3AF] hover:text-[#E0E7FF] transition-colors duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left-circle"><circle cx="12" cy="12" r="10"/><path d="m12 8-4 4 4 4"/><path d="M16 12H8"/></svg>
                    <span class="ml-2">वापस</span>
                </button>
                <h1 class="text-2xl font-bold font-poppins text-center flex-grow">वीडियो विज्ञापन देखें</h1>
            </div>

            <p class="text-center text-sm text-[#9CA3AF] mb-6">आवश्यक: <span id="offer-points-required" class="font-bold text-[#E0E7FF]">0</span> अंक</p>
            
            <div class="flex flex-col items-center mb-6">
                <button id="watch-ad-button" class="w-full py-4 px-6 bg-green-500 text-white rounded-xl font-bold text-xl flex items-center justify-center hover:bg-green-600 transition-colors duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play-circle mr-2"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>
                    वीडियो देखें
                </button>
                <div class="mt-4 text-center">
                    <p class="text-sm text-gray-400">वीडियो देखने के बाद, आपको अंक मिलेंगे।</p>
                </div>
            </div>
        </div>
    </div>

    <!-- निकासी स्क्रीन -->
    <div id="withdrawal-screen" class="screen">
        <div class="card p-6 bg-[#1E293B] rounded-2xl shadow-lg w-full max-w-xl">
            <div class="flex items-center justify-between mb-4">
                <button id="back-from-withdrawal" class="flex items-center text-[#9CA3AF] hover:text-[#E0E7FF] transition-colors duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left-circle"><circle cx="12" cy="12" r="10"/><path d="m12 8-4 4 4 4"/><path d="M16 12H8"/></svg>
                    <span class="ml-2">वापस</span>
                </button>
                <h1 id="withdrawal-title" class="text-2xl font-bold font-poppins text-center flex-grow">रिवॉर्ड निकालें</h1>
            </div>
            
            <div id="withdrawal-detail-container" class="mt-4">
                <!-- विशिष्ट इनपुट यहाँ JS द्वारा जोड़े जाएंगे -->
            </div>

            <button id="submit-withdrawal-button" class="w-full py-3 mt-6 bg-[#6366F1] text-white rounded-xl font-semibold text-lg hover:bg-[#4F46E5] transition-colors duration-300">
                सबमिट करें
            </button>
        </div>
    </div>

    <!-- लोडिंग स्क्रीन -->
    <div id="loading-screen" class="screen fixed top-0 left-0 w-full h-full bg-[#151A25] z-50">
        <div class="flex flex-col items-center justify-center">
            <div class="w-12 h-12 border-4 border-t-4 border-[#6366F1] rounded-full animate-spin border-gray-200 mb-4"></div>
            <p class="text-lg text-white">लोड हो रहा है...</p>
        </div>
    </div>

    <!-- modals -->
    <!-- सामान्य संदेश मॉडल -->
    <div id="message-modal" class="modal hidden">
        <div class="modal-content bg-[#1E293B]">
            <h2 id="message-title" class="text-2xl font-bold mb-4"></h2>
            <p id="message-body" class="mb-6"></p>
            <button id="message-close-button" class="w-full py-2 px-4 bg-[#6366F1] text-white rounded-lg font-semibold hover:bg-[#4F46E5]">ओके</button>
        </div>
    </div>
    
    <!-- वीडियो प्लेयर मॉडल -->
    <div id="video-player-modal" class="modal hidden">
        <div class="modal-content relative">
            <button id="video-close-button" class="close-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
            <video id="reward-video" controls playsinline>
                <source src="https://assets.mixkit.co/videos/preview/mixkit-girl-staring-at-her-smartphone-4467-large.mp4" type="video/mp4">
                आपका ब्राउज़र वीडियो टैग का समर्थन नहीं करता।
            </video>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, collection, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase कॉन्फ़िगरेशन और इनिशियलाइज़ेशन
        const firebaseConfig = JSON.parse(__firebase_config);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const userId = typeof __initial_auth_token !== 'undefined' ? auth.currentUser?.uid : crypto.randomUUID();
        const firestoreUserId = typeof __initial_auth_token !== 'undefined' ? auth.currentUser?.uid : 'anonymous';

        // Firebase ऑथेंटिकेशन
        const authPromise = new Promise(async (resolve, reject) => {
            try {
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
                console.log("Firebase Auth successful");
                resolve();
            } catch (error) {
                console.error("Firebase Auth failed:", error);
                reject(error);
            }
        });
        
        let userPoints = 0;
        let isAuthReady = false;
        let currentOffer = null;

        const screens = {
            'main-screen': document.getElementById('main-screen'),
            'home-screen': document.getElementById('home-screen'),
            'rewards-screen': document.getElementById('rewards-screen'),
            'offer-screen': document.getElementById('offer-screen'),
            'withdrawal-screen': document.getElementById('withdrawal-screen'),
            'loading-screen': document.getElementById('loading-screen')
        };
        const modals = {
            'message-modal': document.getElementById('message-modal'),
            'video-player-modal': document.getElementById('video-player-modal')
        };
        const dom = {
            startButton: document.getElementById('start-button'),
            claimButton: document.getElementById('claim-button'),
            backToHomeButton: document.getElementById('back-to-home-button'),
            backFromWithdrawal: document.getElementById('back-from-withdrawal'),
            backToRewardsButton: document.getElementById('back-to-rewards-button'),
            googlePlayCard: document.querySelector('.offer-card[alt="Google Play Icon"]').parentElement,
            freeFireCard: document.querySelector('.offer-card[alt="Free Fire Icon"]').parentElement,
            rewardsTitle: document.getElementById('rewards-title'),
            googlePlayOffers: document.getElementById('google-play-offers'),
            freeFireOffers: document.getElementById('free-fire-offers'),
            userPointsElement: document.getElementById('user-points'),
            offerPointsRequired: document.getElementById('offer-points-required'),
            watchAdButton: document.getElementById('watch-ad-button'),
            submitWithdrawalButton: document.getElementById('submit-withdrawal-button'),
            withdrawalTitle: document.getElementById('withdrawal-title'),
            withdrawalDetailContainer: document.getElementById('withdrawal-detail-container'),
            messageTitle: document.getElementById('message-title'),
            messageBody: document.getElementById('message-body'),
            messageCloseButton: document.getElementById('message-close-button'),
            videoPlayer: document.getElementById('reward-video'),
            videoCloseButton: document.getElementById('video-close-button'),
        };

        const offers = {
            'Google Play': [
                { id: 'gp100', type: '₹100', points: 2000, game: 'Google Play', icon: 'https://placehold.co/80x80/2D3748/FFFFFF?text=Google+Play' },
                { id: 'gp500', type: '₹500', points: 10000, game: 'Google Play', icon: 'https://placehold.co/80x80/2D3748/FFFFFF?text=Google+Play' }
            ],
            'Free Fire': [
                { id: 'ff100', type: '100 हीरे', points: 1500, game: 'Free Fire', icon: 'https://placehold.co/80x80/2D3748/FFFFFF?text=Free+Fire' },
                { id: 'ff500', type: '500 हीरे', points: 7500, game: 'Free Fire', icon: 'https://placehold.co/80x80/2D3748/FFFFFF?text=Free+Fire' }
            ]
        };

        const showScreen = (screenId, isMain = false) => {
            Object.values(screens).forEach(screen => {
                screen.classList.remove('active');
                if (screen.style) {
                    screen.style.display = 'none';
                }
            });
            const screenToShow = screens[screenId];
            if (screenToShow) {
                screenToShow.style.display = 'flex';
                setTimeout(() => {
                    screenToShow.classList.add('active');
                }, 10);
            }
        };

        const showModal = (modalId) => {
            const modal = modals[modalId];
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        };

        const hideModals = () => {
            Object.values(modals).forEach(modal => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            });
        };

        const showMessageModal = (title, body, onClose, type = 'info') => {
            dom.messageTitle.textContent = title;
            dom.messageBody.textContent = body;
            dom.messageCloseButton.onclick = () => {
                hideModals();
                if (onClose) {
                    onClose();
                }
            };
            showModal('message-modal');
        };

        // उपयोगकर्ता डेटा को लोड या इनिशियलाइज़ करने का फंक्शन
        const loadUserData = async () => {
            showScreen('loading-screen');
            try {
                const docRef = doc(db, `artifacts/${appId}/users/${firestoreUserId}/data`, 'userProfile');
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    userPoints = data.points || 0;
                    console.log("User data loaded:", data);
                } else {
                    await setDoc(docRef, { points: 0, createdAt: serverTimestamp() });
                    userPoints = 0;
                    console.log("New user profile created.");
                }
                dom.userPointsElement.textContent = userPoints;
            } catch (error) {
                console.error("Error loading user data:", error);
                showMessageModal("त्रुटि", "उपयोगकर्ता डेटा लोड करने में त्रुटि। कृपया पुनः प्रयास करें।", null, 'error');
            } finally {
                showScreen('home-screen');
            }
        };

        // अंक अपडेट करने का फंक्शन
        const updatePoints = async (amount) => {
            try {
                const userDocRef = doc(db, `artifacts/${appId}/users/${firestoreUserId}/data`, 'userProfile');
                await updateDoc(userDocRef, {
                    points: userPoints + amount
                });
                userPoints += amount;
                dom.userPointsElement.textContent = userPoints;
            } catch (error) {
                console.error("Error updating points:", error);
            }
        };
        
        // ऑफ़र कार्ड्स को डायनामिक रूप से रेंडर करने का फंक्शन
        const renderOffers = (offersData, containerId, gameName) => {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            offersData.forEach(offer => {
                const card = document.createElement('div');
                card.className = 'offer-card flex flex-col items-center p-4 bg-[#2D3748] rounded-xl text-center';
                card.innerHTML = `
                    <img src="${offer.icon}" alt="${offer.game} Icon" class="w-20 h-20 mb-2">
                    <h3 class="font-semibold text-lg">${offer.type}</h3>
                    <p class="text-sm text-gray-400">आवश्यक: ${offer.points} अंक</p>
                    <button class="claim-offer-button mt-2 py-1 px-4 bg-[#6366F1] text-white rounded-md text-sm hover:bg-[#4F46E5]" data-offer-id="${offer.id}">दावा करें</button>
                `;
                card.onclick = () => {
                    currentOffer = offer;
                    dom.offerPointsRequired.textContent = offer.points;
                    showScreen('offer-screen');
                };
                container.appendChild(card);
            });
        };

        // इवेंट लिसनर्स
        authPromise.then(() => {
            isAuthReady = true;
            loadUserData();
        });
        
        dom.startButton.addEventListener('click', () => showScreen('home-screen'));

        dom.claimButton.addEventListener('click', () => showScreen('rewards-screen'));

        dom.backToHomeButton.addEventListener('click', () => showScreen('home-screen'));

        dom.backFromWithdrawal.addEventListener('click', () => {
            showScreen('rewards-screen');
            currentOffer = null;
        });

        dom.backToRewardsButton.addEventListener('click', () => showScreen('rewards-screen'));
        
        dom.googlePlayCard.addEventListener('click', () => {
            dom.rewardsTitle.textContent = "Google Play रिवॉर्ड्स";
            dom.googlePlayOffers.style.display = 'grid';
            dom.freeFireOffers.style.display = 'none';
            renderOffers(offers['Google Play'], 'google-play-offers', 'Google Play');
            showScreen('rewards-screen');
        });
        
        dom.freeFireCard.addEventListener('click', () => {
            dom.rewardsTitle.textContent = "Free Fire रिवॉर्ड्स";
            dom.googlePlayOffers.style.display = 'none';
            dom.freeFireOffers.style.display = 'grid';
            renderOffers(offers['Free Fire'], 'free-fire-offers', 'Free Fire');
            showScreen('rewards-screen');
        });

        // वीडियो देखने का इवेंट
        dom.watchAdButton.addEventListener('click', () => {
            const video = dom.videoPlayer;
            video.src = video.querySelector('source').src;
            showModal('video-player-modal');
            video.play();
        });
        
        dom.videoCloseButton.addEventListener('click', () => {
            dom.videoPlayer.pause();
            dom.videoPlayer.currentTime = 0;
            hideModals();
        });

        dom.videoPlayer.addEventListener('ended', () => {
            hideModals();
            if (currentOffer) {
                if (userPoints >= currentOffer.points) {
                    showMessageModal("पर्याप्त अंक", "आप इस रिवॉर्ड को निकाल सकते हैं। 'रिवॉर्ड निकालें' बटन पर क्लिक करें।", () => {
                        showScreen('withdrawal-screen');
                        dom.withdrawalTitle.textContent = `${currentOffer.game} के लिए निकासी`;
                        dom.withdrawalDetailContainer.innerHTML = '';
                        if (currentOffer.game === 'Google Play') {
                            dom.withdrawalDetailContainer.innerHTML = `
                                <input id="uid-input" type="email" placeholder="अपना ईमेल दर्ज करें" class="w-full p-3 rounded-lg bg-[#2D3748] text-[#E0E7FF] border border-[#4A5568] focus:outline-none focus:ring-2 focus:ring-[#6366F1]">
                            `;
                        } else if (currentOffer.game === 'Free Fire') {
                            dom.withdrawalDetailContainer.innerHTML = `
                                <input id="uid-input" type="text" placeholder="अपनी Free Fire UID दर्ज करें" class="w-full p-3 rounded-lg bg-[#2D3748] text-[#E0E7FF] border border-[#4A5568] focus:outline-none focus:ring-2 focus:ring-[#6366F1]">
                            `;
                        }
                    });
                } else {
                    const pointsToAdd = Math.floor(Math.random() * 50) + 10;
                    updatePoints(pointsToAdd);
                    showMessageModal("सफलता", `आपने वीडियो देखने के लिए ${pointsToAdd} अंक अर्जित किए!`, () => {
                        showScreen('home-screen');
                    });
                }
            } else {
                showScreen('home-screen');
            }
        });

        dom.submitWithdrawalButton.addEventListener('click', async () => {
            const detailInput = document.getElementById('uid-input').value.trim();
            if (!detailInput) {
                showMessageModal("त्रुटि", "कृपया अपना विवरण दर्ज करें।");
                return;
            }

            if (userPoints < currentOffer.points) {
                showMessageModal("त्रुटि", "आपके पास इस रिवॉर्ड को निकालने के लिए पर्याप्त अंक नहीं हैं।");
                return;
            }

            try {
                await updatePoints(-currentOffer.points);

                // Firestore में निकासी अनुरोध सहेजें
                const withdrawalsCollectionRef = collection(db, `artifacts/${appId}/public/data`, 'withdrawals');
                await addDoc(withdrawalsCollectionRef, {
                    userId: firestoreUserId,
                    game: currentOffer.game,
                    offer: currentOffer,
                    withdrawalDetail: detailInput,
                    status: "pending",
                    createdAt: serverTimestamp()
                });

                showMessageModal("सफलता!", `आपका ${currentOffer.game} ${currentOffer.type} 24 घंटे के भीतर आपके ${currentOffer.game === 'Google Play' ? 'ईमेल' : 'प्रदान किए गए विवरण'} पर भेज दिया जाएगा।`, () => {
                    hideModals();
                    showScreen('home-screen', true);
                }, 'success');

            } catch (error) {
                console.error("निकासी त्रुटि:", error);
                showMessageModal("त्रुटि", "आपके अनुरोध पर कार्रवाई करने में त्रुटि थी। कृपया पुनः प्रयास करें।", null, 'error');
            } finally {
                document.getElementById('uid-input').value = '';
                currentOffer = null;
            }
        });

    </script>
    
    <!-- सर्विस वर्कर पंजीकरण -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
